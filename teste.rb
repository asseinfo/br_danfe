# require('byebug')
require_relative('lib/br_danfe')
require('i18n')
I18n.locale = 'pt-BR'

xml = '<nfeProc xmlns="http://www.portalfiscal.inf.br/nfe" versao="4.00"><NFe xmlns="http://www.portalfiscal.inf.br/nfe"><infNFe versao="4.00" Id="NFe23200518665944000143550010000039191182910235"><ide><cUF>23</cUF><cNF>18291023</cNF><natOp>Venda</natOp><mod>55</mod><serie>1</serie><nNF>3919</nNF><dhEmi>2020-05-29T00:00:00-03:00</dhEmi><tpNF>1</tpNF><idDest>1</idDest><cMunFG>2304285</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>5</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>0</indFinal><indPres>9</indPres><procEmi>0</procEmi><verProc>facil123.com.br</verProc></ide><emit><CNPJ>18665944000143</CNPJ><xNome>Maran e Seibert Ind., Com., Imp., e Exp. de Prod Ali. LTDA</xNome><xFant>Brasil da Fruta</xFant><enderEmit><xLgr>R. Liberalino Carlos Silva</xLgr><nro>160</nro><xBairro>Centro</xBairro><cMun>2304285</cMun><xMun>EUSEBIO</xMun><UF>CE</UF><CEP>61760000</CEP><cPais>1058</cPais><xPais>Brasil</xPais><fone>85989703616</fone></enderEmit><IE>067024580</IE><CRT>3</CRT></emit><dest><CNPJ>14780004000144</CNPJ><xNome>LH COMERCIO DE DERIVADOS DE PETROLEO LTDA - EPP</xNome><enderDest><xLgr>Rodovia Ce 040</xLgr><nro>S/N</nro><xCpl>KM 10</xCpl><xBairro>Jacunda</xBairro><cMun>2301000</cMun><xMun>AQUIRAZ</xMun><UF>CE</UF><CEP>61700996</CEP><cPais>1058</cPais><xPais>Brasil</xPais><fone>85982140506</fone></enderDest><indIEDest>1</indIEDest><IE>066260361</IE><email>postoprimeiracapital@gmail.com</email></dest><det nItem="1"><prod><cProd>BA2160</cProd><cEAN>SEM GTIN</cEAN><xProd>BALDE AÇAÍ PURO 10L</xProd><NCM>21050090</NCM><CFOP>5401</CFOP><uCom>UN</uCom><qCom>1.0</qCom><vUnCom>110.0</vUnCom><vProd>110.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>UN</uTrib><qTrib>1.0</qTrib><vUnTrib>110.0</vUnTrib><vDesc>5.00</vDesc><indTot>1</indTot></prod><imposto><ICMS><ICMS10><orig>0</orig><CST>10</CST><modBC>3</modBC><vBC>105.00</vBC><pICMS>7.55</pICMS><vICMS>7.93</vICMS><modBCST>4</modBCST><pMVAST>70.00</pMVAST><pRedBCST>100.00</pRedBCST><vBCST>178.50</vBCST><pICMSST>7.55</pICMSST><vICMSST>5.55</vICMSST></ICMS10></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISAliq><CST>01</CST><vBC>105.00</vBC><pPIS>0.65</pPIS><vPIS>0.68</vPIS></PISAliq></PIS><COFINS><COFINSAliq><CST>01</CST><vBC>105.00</vBC><pCOFINS>3.00</pCOFINS><vCOFINS>3.15</vCOFINS></COFINSAliq></COFINS></imposto></det><total><ICMSTot><vBC>105.00</vBC><vICMS>7.93</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>178.50</vBCST><vST>5.55</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>110.00</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>5.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.68</vPIS><vCOFINS>3.15</vCOFINS><vOutro>0.00</vOutro><vNF>110.55</vNF></ICMSTot></total><transp><modFrete>9</modFrete></transp><cobr><fat><nFat>3919</nFat><vOrig>115.55</vOrig><vDesc>5.00</vDesc><vLiq>110.55</vLiq></fat><dup><nDup>001</nDup><dVenc>2020-05-29</dVenc><vDup>110.55</vDup></dup></cobr><pag><detPag><indPag>0</indPag><tPag>05</tPag><vPag>110.55</vPag></detPag></pag><infAdic><infCpl>Trib aprox R$: 5,91 Federal e 7,93 Estadual Fonte: IBPT/empresometro.com.br 0C3829 * Devolução de 01 balde. Enviar nota fiscal</infCpl></infAdic><infRespTec><CNPJ>04267593000108</CNPJ><xContato>César Luiz dos Anjos Júnior</xContato><email>desenvolvedores@asseinfo.com.br</email><fone>4832637137</fone></infRespTec></infNFe><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI="#NFe23200518665944000143550010000039191182910235"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>xPS7R+FG02XRb5W5phw4zcKXIIE=</DigestValue></Reference></SignedInfo><SignatureValue>jpAusnv+9weN7SKu7io9UoX6mh5jSrydlTJPKBnWOJJe11etjlios3teeoOD\nlO55aIAoSA4OZFc0SHi6AmkvU2XI4L2gTC8En8ZhyCz6WGr59eQn5ZUYxMit\nc3jnQUpD9wP9YkLjyKnLdS64goOWBxvX8tnW+dfjF/peeMWnVqSO7UOIK8jq\nt4gClT0k2JqfBZDXnfQ6iiBuQhY8xA87mgyQ/p8eIduhiYuY/JSIpCqjA7iD\nywUVXnkd5sOc82hAM7a+gEkzwwio0wAXSDldcPfrWcYVP4DPAoEXC8kr4FHg\nWVu23tTpPdQqFsn/TpyrLt7di9T6Tf8g6xH9lmACXw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIIDTCCBfWgAwIBAgIQccy/lHHhhK4itMwqyu4sxjANBgkqhkiG9w0BAQsFADB4MQswCQYDVQQGEwJCUjETMBEGA1UEChMKSUNQLUJyYXNpbDE2MDQGA1UECxMtU2VjcmV0YXJpYSBkYSBSZWNlaXRhIEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRwwGgYDVQQDExNBQyBDZXJ0aXNpZ24gUkZCIEc1MB4XDTE5MTExNDE3MjkyMVoXDTIwMTExMzE3MjkyMVowgfUxCzAJBgNVBAYTAkJSMRMwEQYDVQQKDApJQ1AtQnJhc2lsMQswCQYDVQQIDAJDRTEQMA4GA1UEBwwHRXVzZWJpbzE2MDQGA1UECwwtU2VjcmV0YXJpYSBkYSBSZWNlaXRhIEZlZGVyYWwgZG8gQnJhc2lsIC0gUkZCMRYwFAYDVQQLDA1SRkIgZS1DTlBKIEExMRcwFQYDVQQLDA4xODczMjY4NjAwMDE3MDFJMEcGA1UEAwxATUFSQU4gRSBTRUlCRVJUIElORFVTVFJJQSBDT01FUkNJTyBJTVBPUlRBQ0FPIEUgRToxODY2NTk0NDAwMDE0MzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMgVcPZrAeXvKmN4q4dHHkdcluTjRDNeO0DH1SEqy2f0bLEPhFihlzidRkbPtY7Qcfjw6L6b0iXmJ7WEJU2zSsbhE69rMx2v0WH5glX0ZnWmmuLUdZfOYuS34H62Cofjh4+D0Zbz855yfXPg8XMKCNwxObqbPnZQLZd+/jw+GKImdj1+efOR/bCiI7TsXtQPqmjpxLW5EZf7jYyxZvTsfQV5nwGsOKd2KzUvWkRxNo7cGYZuOAARSmfExxNTr7WIs9R54Yj5G3LcoaoEaxD1zPkoFjQZWI1/9epincZsZQ+rUvjkMuxqEgHh29lZ5m27Ot1xJfpZ8tcI9OTkWi26N90CAwEAAaOCAxMwggMPMIHCBgNVHREEgbowgbegPQYFYEwBAwSgNAQyMjIxMDE5ODIwNTg4ODQ5MTYyNDAwMDAwMDAwMDAwMDAwMDBNRzExMzc0NzI0U1NQTUegJgYFYEwBAwKgHQQbVElBR08gSEVOUklRVUUgTUFSQU4gVklFSVJBoBkGBWBMAQMDoBAEDjE4NjY1OTQ0MDAwMTQzoBcGBWBMAQMHoA4EDDAwMDAwMDAwMDAwMIEadGlhZ29AYnJhc2lsZGFmcnV0YS5jb20uYnIwCQYDVR0TBAIwADAfBgNVHSMEGDAWgBRTfX+dvtFh0CC62p/jiacTc1jNQjB/BgNVHSAEeDB2MHQGBmBMAQIBDDBqMGgGCCsGAQUFBwIBFlxodHRwOi8vaWNwLWJyYXNpbC5jZXJ0aXNpZ24uY29tLmJyL3JlcG9zaXRvcmlvL2RwYy9BQ19DZXJ0aXNpZ25fUkZCL0RQQ19BQ19DZXJ0aXNpZ25fUkZCLnBkZjCBvAYDVR0fBIG0MIGxMFegVaBThlFodHRwOi8vaWNwLWJyYXNpbC5jZXJ0aXNpZ24uY29tLmJyL3JlcG9zaXRvcmlvL2xjci9BQ0NlcnRpc2lnblJGQkc1L0xhdGVzdENSTC5jcmwwVqBUoFKGUGh0dHA6Ly9pY3AtYnJhc2lsLm91dHJhbGNyLmNvbS5ici9yZXBvc2l0b3Jpby9sY3IvQUNDZXJ0aXNpZ25SRkJHNS9MYXRlc3RDUkwuY3JsMA4GA1UdDwEB/wQEAwIF4DAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQwgawGCCsGAQUFBwEBBIGfMIGcMF8GCCsGAQUFBzAChlNodHRwOi8vaWNwLWJyYXNpbC5jZXJ0aXNpZ24uY29tLmJyL3JlcG9zaXRvcmlvL2NlcnRpZmljYWRvcy9BQ19DZXJ0aXNpZ25fUkZCX0c1LnA3YzA5BggrBgEFBQcwAYYtaHR0cDovL29jc3AtYWMtY2VydGlzaWduLXJmYi5jZXJ0aXNpZ24uY29tLmJyMA0GCSqGSIb3DQEBCwUAA4ICAQBFh4giFyl9VQQhZMKrRmZz6HtATBNZkvI8CO6cGsCm8IdOJ+Utyc1+WPnhXzTq6o6H3a0kv2YRmTgCOXFdT+KMoY8y0mSdvTs/mq1PjXlSEe6eSFonYMg7ywTpuPPpQMlTDGqejkPhJLLtsM6owJf7gUY3870Zm2OCiZZhrcbrpCJlGzym7E/eopiGBsGFNVtEFafRnPZyJJ6QGKXHTJzTEN4XBJNvQxKg6T0IabFySyBMQ4bxN46G9fyCfdhc16Sq4eoee3TUbDksjf+nokbj8+UXC0PYbdXNRtURwROn5qi+mBfQZL9fth0LXKSNWa040Jc2z0NnT6MIuAIa5LAFCAhunMAmbR8X2+zk6Y47cDI4sd/X7sCxdxOGOwrWZmHr+td/7b/F4lpG7yZRE9l21hVRRC1+SMcuU/iWL6hqTtx9ip1VHUnMED1nTuQFVQkj0fkoGgJ00akju2tB7yzLBLa6eHq1pwkynp0AnHKln/Ht3JZvI7e467U4XeblBnsBz3ksfLMwr+FKJJb7OrcJmvS2aVQUIl/HgI/rVLZUUXp+GPZjhXThJ14o8bbGNpFzKNiq9L+bdttG4tYQMF0Qgp/XmfL4JG8+lQQ3e3OWp53wvUA32guGVCtXGSyYiDdIlGMQeE/yDsjPWJDb9aPDfIolOJEPASnxbigWMiUZ8A==</X509Certificate></X509Data></KeyInfo></Signature></NFe><protNFe versao="4.00"><infProt Id="ID123200029308278"><tpAmb>1</tpAmb><verAplic>CE_NFe_V4.1.0</verAplic><chNFe>23200518665944000143550010000039191182910235</chNFe><dhRecbto>2020-05-29T08:20:16-03:00</dhRecbto><nProt>123200029308278</nProt><digVal>xPS7R+FG02XRb5W5phw4zcKXIIE=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso da NF-e</xMotivo></infProt></protNFe></nfeProc>'
danfe = BrDanfe::Danfe.new(xml)

# logo = StringIO.new(File.new('./logo.jpg').read)
# danfe.options.logo = logo
# danfe.options.logo_dimensions = { width: 100, height: 100 }

danfe.save_pdf('./teste.pdf', 'NF-e emitida usando o Fácil123 - https://facil123.com.br - (48) 3181-0189')

# pdf = danfe.render_pdf 'NF-e emitida usando o Fácil123 - https://facil123.com.br - (48) 3181-0189'

# Isso o Fácil não faz, mas salvo pra poder visualizar
# pdf_file = File.new('./teste.pdf', 'w:utf-8')
# pdf_file.write pdf.force_encoding 'utf-8'
